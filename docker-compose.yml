version: '3.8'

services:
  tests:
    build: .
    container_name: saucedemo-tests
    volumes:
      - .:/app
      - ./allure-results:/app/allure-results
      - ./allure-report:/app/allure-report
    environment:
      - PYTHONUNBUFFERED=1
      - DISPLAY=:99
    command: >
      sh -c "
        Xvfb :99 -screen 0 1920x1080x24 &
        sleep 2 &&
        pytest tests/ -v --alluredir=./allure-results &&
        allure generate ./allure-results -o ./allure-report --clean
      "